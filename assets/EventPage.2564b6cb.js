import{i as P,j as V,u as R,a as N,e as v,d as q}from"./QBtn.35dac5c7.js";import{P as A,Q as B}from"./ProfileIcon.01f8e9ac.js";import{L as E}from"./leaflet-src.ffd70e66.js";import{c as w,h as C}from"./uid.8c2a8409.js";import{c as k,h as S,g as j,_ as T,J as g,K as a,L as O,M as m,f as l,Y as Q,Z as u,I as L,W as d,u as b,a8 as y,N as r,al as z,O as h,F as I,X as H,am as J,an as x}from"./index.2d1c1e3f.js";import{Q as F}from"./QMenu.604f0253.js";import{c as G}from"./convertDate.2fe32ce1.js";import"./QChip.6e1e99aa.js";import"./rtl.b51694b1.js";import"./format.3e32b8d9.js";import"./scroll.55c5e954.js";var M=w({name:"QCardActions",props:{...P,vertical:Boolean},setup(e,{slots:t}){const n=V(e),c=k(()=>`q-card__actions ${n.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>S("div",{class:c.value},C(t.default))}}),Z=w({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(e,{slots:t}){const n=k(()=>`q-card__section q-card__section--${e.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>S(e.tag,{class:n.value},C(t.default))}}),$=w({name:"QCard",props:{...R,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(e,{slots:t}){const{proxy:{$q:n}}=j(),c=N(e,n),s=k(()=>"q-card"+(c.value===!0?" q-card--dark q-dark":"")+(e.bordered===!0?" q-card--bordered":"")+(e.square===!0?" q-card--square no-border-radius":"")+(e.flat===!0?" q-card--flat no-shadow":""));return()=>S(e.tag,{class:s.value},C(t.default))}});const K={props:{message:String,showDialog:Boolean},computed:{isDialogVisible:{get(){return this.showDialog},set(e){this.$emit("update:showDialog",e)}}},methods:{confirm(){this.$emit("confirmed")},cancel(){this.$emit("canceled")}}};function W(e,t,n,c,s,o){const _=g("q-card-title");return a(),O(F,{modelValue:o.isDialogVisible,"onUpdate:modelValue":t[0]||(t[0]=f=>o.isDialogVisible=f),position:"top"},{default:m(()=>[l($,null,{default:m(()=>[l(Z,null,{default:m(()=>[l(_,{class:"text-h6"},{default:m(()=>[Q(u(n.message),1)]),_:1}),l(M,null,{default:m(()=>[l(v,{label:"\u0421\u043A\u0430\u0441\u0443\u0432\u0430\u0442\u0438",color:"primary",onClick:o.cancel},null,8,["onClick"]),l(v,{label:"\u041F\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438",color:"negative",onClick:o.confirm},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var X=T(K,[["render",W]]);const Y={components:{ProfileIcon:A},data(){return{showDialog:!1,confirmationMessage:"\u0412\u0438 \u0432\u043F\u0435\u0432\u043D\u0435\u043D\u0456, \u0449\u043E \u0445\u043E\u0447\u0435\u0442\u0435 \u0432\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u0446\u044E \u043F\u043E\u0434\u0456\u044E?",API_URL:"https://map-of-activities-moa-back.onrender.com/api",buttonColor:"#1ab240",isSubscribed:!1,curUser:null,curRole:null,fullAddress:null,EventPage:!0,showReportDetails:!1,reportHeader:null,reportDescription:"",showReportButton:!0,options:["\u041D\u0435\u0446\u0435\u043D\u0437\u0443\u0440\u043D\u0435 \u043D\u0430\u0437\u0432\u0430 \u043F\u043E\u0434\u0456\u0457","\u041D\u0435\u0446\u0435\u043D\u0437\u0443\u0440\u043D\u0430 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0456\u044F \u043F\u043E\u0434\u0456\u0457","\u041D\u0435\u043A\u043E\u0440\u0435\u043A\u0442\u043D\u0430/\u0444\u0430\u043B\u044C\u0448\u0438\u0432\u0430 \u0444\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0456\u044F \u043F\u043E\u0434\u0456\u0457","\u041D\u0435\u043A\u043E\u0440\u0435\u043A\u0442\u043D\u0430 \u043B\u043E\u043A\u0430\u0446\u0456\u044F \u043F\u043E\u0434\u0456\u0457","\u041D\u0435\u043A\u043E\u0440\u0435\u043A\u0442\u043D\u0438\u0439 \u0447\u0430\u0441 \u043F\u043E\u0434\u0456\u0457","\u041D\u0435\u0432\u0456\u0434\u043F\u043E\u0432\u0456\u0434\u043D\u0456 \u0434\u0430\u043D\u0456","\u0424\u0430\u043B\u044C\u0448\u0438\u0432\u0430 \u043F\u043E\u0434\u0456\u044F","\u0406\u043D\u0448\u0435"]}},props:{id:{type:[Number,String],required:!0}},computed:{...L({event:"getEvent",eventStatus:"getEventStatus",eventUsers:"getEventUsers",usersStatus:"getVisitingUsersStatus",joined:"getJoined",joinedStatus:"getJoinedStatus",profile:"getProfile"}),isNextDisabled(){return!(this.name&&this.name.length<=50&&/^[?!@()№,.;:a-zA-Zа-яА-ЯґҐіІїЇєЄ0-9\s]*$/u.test(this.name)&&this.typeId&&timeValidation===!0&&this.address)},buttonText:function(){return this.isSubscribed?"\u0412\u0456\u0434'\u0454\u0434\u043D\u0430\u0442\u0438\u0441\u044C":"\u041F\u0440\u0438\u0454\u0434\u043D\u0430\u0442\u0438\u0441\u044C"},filteredEvent(){const e=["name","type","startTime","endTime","description","coordinates","user"];return(n=>Object.fromEntries(Object.entries(n).filter(([c,s])=>!!(e.includes(c)&&s!==null&&s!==""&&s!==void 0))))(this.event)}},async mounted(){await this.getEvent(),await this.getCurUser(),await this.getEventUsers()},methods:{backToEventPage(){this.showReportDetails=!1,this.EventPage=!0},reportPage(){this.showReportDetails=!0,this.EventPage=!1},convertJSONToDate(e){return G(e)},deleteEvent(){console.log(this.curRole),this.$store.dispatch("DELETE_EVENT",{id:this.id,handler:e=>{this.$store.dispatch("GET_EVENTS"),this.$router.push({name:"events-list",params:{}})},handlerError:e=>{alert("Error occurred: "+e.response.data)}})},editEvent(){this.$router.push({name:"edit-event",params:this.event,query:{event:this.event.id}})},async joinEvent(){this.isSubscribed=!this.isSubscribed;const e=this.$store.getters.getCurrentUser;this.isSubscribed?this.$store.dispatch("CREATE_VISITING",{id:e,eventId:this.event.id,handler:t=>{},handlerError:t=>{alert("Error occurred: "+t)}}):this.$store.dispatch("DELETE_VISITING",{id:e,eventId:this.event.id,handler:t=>{},handlerError:t=>{alert("Error occurred: "+t)}})},showMap(){if(this.event!=null){const e=this.event.coordinates.split(", ").map(parseFloat),t=e.map(c=>c.toFixed(2)),n=E.map("map4").setView(t,13);E.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(n),E.marker(this.event.coordinates.split(", ").map(parseFloat)).addTo(n),this.getAddressFromCoordinates(e[0],e[1])}},async getEvent(){await Promise.all([this.event!={}?this.$store.dispatch("GET_EVENT",{id:this.id}):void 0]),this.showMap()},async getAddressFromCoordinates(e,t){const n=`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${t}&format=json`;try{const s=await(await fetch(n)).json();if(s.address){const o=s.display_name;this.fullAddress=o}else console.error("Address not found")}catch(c){console.error("Error fetching address:",c)}},async getCurUser(){this.curUser=this.$store.getters.getCurrentUser,this.curRole=this.$store.getters.getCurrentRole;const e=this.$store.getters.getEvent.id;await Promise.all([this.$store.dispatch("GET_IS_JOINER",{id:this.curUser,eventId:e})]),this.isSubscribed=this.$store.getters.getJoined,this.curUser!=this.event.user.userId?this.showReportButton=!0:this.showReportButton=!1},async getEventUsers(){const e=this.$store.getters.getEvent.id;await Promise.all([this.$store.dispatch("GET_USERS_GO_TO_THE_EVENT",{eventId:e})]),this.eventUsers=this.$store.getters.getEventUsers,console.log(this.eventUsers)},async reportEvent(){if(!this.reportHeader){alert("\u0411\u0443\u0434\u044C \u043B\u0430\u0441\u043A\u0430, \u0432\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u0434\u043B\u044F \u0432\u0430\u0448\u043E\u0457 \u0441\u043A\u0430\u0440\u0433\u0438");return}if(this.reportHeader==="\u0406\u043D\u0448\u0435"&&!this.reportDescription){alert('\u0412\u0438 \u0432\u0438\u0431\u0440\u0430\u043B\u0438 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A "\u0406\u043D\u0448\u0435", \u0431\u0443\u0434\u044C \u043B\u0430\u0441\u043A\u0430, \u0434\u043E\u0434\u0430\u0439\u0442\u0435 \u043E\u043F\u0438\u0441 \u0412\u0430\u0448\u043E\u0457 \u0441\u043A\u0430\u0440\u0433\u0438');return}const e=this.$store.getters.getProfile;this.$store.dispatch("REPORT_EVENT",{formData:{Header:this.reportHeader,Description:this.reportDescription,EventId:this.event.id,AuthorId:e.id},handler:t=>{this.$router.replace({path:"/event-page",name:"event",query:{id:this.event.id}}),this.showReportDetails=!1,this.EventPage=!0,this.reportHeader="",this.reportDescription=""},handlerError:t=>{console.log("error: "+t),alert("Error occurred: "+t)}})}},components:{DialogConfirmation:X}},p=e=>(J("data-v-16140ad0"),e=e(),x(),e),ee={key:0,class:"p-3"},te={class:"navbar"},se={class:"!px-0"},re={class:"!px-0"},oe={class:"ml-auto"},ne={class:"col_conteiner"},ie={class:"column"},ae={key:0},le=["src"],de={key:1,class:"text_conteinet"},ce={key:2,class:"text_conteinet px-4"},ue=p(()=>r("h2",null,"\u0414\u043E \u043F\u043E\u0434\u0456\u0457 \u043F\u0440\u0438\u0454\u0434\u043D\u0430\u043B\u0438\u0441\u044C:",-1)),he={class:"users-avatar-container"},pe=["src"],me={key:1,class:"users-icon-container"},ve={class:"column"},ge={class:"white_conteiner"},_e=p(()=>r("h2",null,"\u0427\u0430\u0441",-1)),fe={key:0,class:"white_conteiner"},Ee=p(()=>r("h2",null,"\u041B\u043E\u043A\u0430\u0446\u0456\u044F",-1)),be={style:{"line-height":"1"}},ye={style:{"line-height":"2"}},we=p(()=>r("div",{id:"map4",class:"map"},null,-1)),Ce={key:1,class:"white_conteiner"},ke=p(()=>r("h2",null,"\u0410\u0432\u0442\u043E\u0440",-1)),Se={class:"TopLine"},De=p(()=>r("div",{style:{"font-size":"16px","font-weight":"550"}},"\u0414\u0435\u0442\u0430\u043B\u0456 \u0441\u043A\u0430\u0440\u0433\u0438 \u043D\u0430 \u043F\u043E\u0434\u0456\u044E",-1)),Ie={class:"inputStyle"},Te=p(()=>r("div",{style:{"font-size":"16px","font-weight":"500",margin:"10px"}}," \u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u0434\u043B\u044F \u0441\u043A\u0430\u0440\u0433\u0438 ",-1)),Ue=p(()=>r("div",{style:{"font-size":"16px","font-weight":"500",margin:"10px"}}," \u0414\u0435\u0442\u0430\u043B\u044C\u043D\u0438\u0439 \u043E\u043F\u0438\u0441 \u0412\u0430\u0448\u043E\u0457 \u0441\u043A\u0430\u0440\u0433\u0438 (\u043E\u043F\u0446\u0456\u043E\u043D\u0430\u043B\u044C\u043D\u043E) ",-1));function Pe(e,t,n,c,s,o){var D;const _=g("ProfileIcon"),f=g("router-link"),U=g("dialog-confirmation");return a(),d(I,null,[b(r("div",null,[e.event!=null&&e.event.type!=null?(a(),d("div",ee,[r("div",te,[r("div",null,[r("h1",se,u(e.event.name),1),r("h4",re,u(e.event.type.name),1)]),b(r("div",oe,[l(v,{onClick:o.reportPage,label:"\u0421\u043A\u0430\u0440\u0433\u0430",color:"orange-10"},null,8,["onClick"])],512),[[y,s.showReportButton]]),r("button",{class:z([{"bg-red-700":!s.isSubscribed,"bg-gray-700":s.isSubscribed},"join-button !mx-0"]),onClick:t[0]||(t[0]=(...i)=>o.joinEvent&&o.joinEvent(...i))},u(o.buttonText),3)]),r("div",ne,[r("div",ie,[e.event.imageName!=null?(a(),d("div",ae,[r("img",{class:"w-full",src:s.API_URL+"/images/"+e.event.imageName,style:{"margin-bottom":"20px"}},null,8,le)])):h("",!0),e.event.description!=null&&e.event.description!=""?(a(),d("div",de,[r("p",null,u(e.event.description),1)])):h("",!0),((D=e.eventUsers)==null?void 0:D.length)!=0?(a(),d("div",ce,[ue,r("div",he,[(a(!0),d(I,null,H(e.eventUsers,i=>(a(),d("div",{key:i.id,class:"avatars-container"},[l(f,{to:"/profile-page?id="+i.userId},{default:m(()=>[i.imageURL?(a(),d("img",{key:0,src:this.API_URL+"/images/"+i.imageURL,class:"users-image"},null,8,pe)):(a(),d("div",me,[l(_)]))]),_:2},1032,["to"])]))),128))])])):h("",!0)]),r("div",ve,[r("div",ge,[_e,r("p",null,"\u041F\u043E\u0447\u0430\u0442\u043E\u043A: "+u(o.convertJSONToDate(e.event.startTime)),1),r("p",null,"\u041A\u0456\u043D\u0435\u0446\u044C: "+u(o.convertJSONToDate(e.event.endTime)),1)]),e.event.coordinates!=null?(a(),d("div",fe,[Ee,r("h3",be,u(s.fullAddress),1),r("h3",ye,"("+u(e.event.coordinates)+")",1),we])):h("",!0),e.event.user!=null?(a(),d("div",Ce,[ke,r("p",null,u(e.event.user.name),1)])):h("",!0)])]),s.curUser!=null&&(s.curRole=="Admin"||s.curUser==e.event.user.userId)?(a(),d("button",{key:0,class:"delete-button",onClick:t[1]||(t[1]=i=>s.showDialog=!0)}," \u0412\u0438\u0434\u0430\u043B\u0438\u0442\u0438 \u043F\u043E\u0434\u0456\u044E ")):h("",!0),l(U,{"show-dialog":s.showDialog,message:s.confirmationMessage,onConfirmed:o.deleteEvent,onCanceled:t[2]||(t[2]=i=>s.showDialog=!1)},null,8,["show-dialog","message","onConfirmed"]),s.curUser!=null&&(s.curRole=="Admin"||s.curUser==e.event.user.userId)?(a(),d("button",{key:1,class:"edit-button",onClick:t[3]||(t[3]=(...i)=>o.editEvent&&o.editEvent(...i))}," \u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u043F\u043E\u0434\u0456\u044E ")):h("",!0)])):h("",!0)],512),[[y,s.EventPage]]),b(r("div",null,[r("div",Se,[l(v,{flat:"",style:"",onClick:o.backToEventPage,icon:"arrow_back",color:"primary"},null,8,["onClick"]),De,l(v,{flat:"",style:"",onClick:o.reportEvent,label:"\u0412\u0456\u0434\u043F\u0440\u0430\u0432\u0438\u0442\u0438",color:"primary"},null,8,["onClick"])]),r("div",Ie,[Te,l(B,{outlined:"",modelValue:s.reportHeader,"onUpdate:modelValue":t[4]||(t[4]=i=>s.reportHeader=i),options:s.options},null,8,["modelValue","options"]),Ue,l(q,{modelValue:s.reportDescription,"onUpdate:modelValue":t[5]||(t[5]=i=>s.reportDescription=i),outlined:"",autogrow:"",clearable:""},null,8,["modelValue"])])],512),[[y,s.showReportDetails]])],64)}var He=T(Y,[["render",Pe],["__scopeId","data-v-16140ad0"]]);export{He as default};
